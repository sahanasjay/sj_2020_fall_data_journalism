---
title: "data_analysis_01"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

## R Markdown

This is an R Markdown document. Markdown is a simple formatting syntax for authoring HTML, PDF, and MS Word documents. For more details on using R Markdown see <http://rmarkdown.rstudio.com>.

When you click the **Knit** button a document will be generated that includes both content as well as the output of any embedded R code chunks within the document. You can embed an R code chunk like this:

```{r cars}
summary(cars)
```

## Including Plots

You can also embed plots, for example:

```{r pressure, echo=FALSE}
plot(pressure)
```

```{r}
# install.packages("sf")
library(janitor)
library(tidyverse)
library(sf)
library(lubridate)
options(scipen = 999)
```


Note that the `echo = FALSE` parameter was added to the code chunk to prevent printing of the R code that generated the plot.
```{r}
streetracing <-read_csv("data/street-racing-fatalities.csv")
fatalities <-read_csv("data/fatalities.csv")
citypop <- st_read("data/hoods.shp")%>%
  as_tibble()%>%
  select(-geometry)

```


```{r}
fatalities_truncated <- fatalities%>%
  select(name, city, death_datetime, death_year)

fatalities_truncated
```
```{r}
commerce_deaths <-fatalities_truncated%>%
  filter(name == "Commerce", death_year >= "2000")

commerce_deaths

```
```{r}
death_by_city <- fatalities_truncated%>%
  group_by(name)%>%
  summarise(city_deaths = n())%>%
  arrange(desc(city_deaths))

death_by_city
```
```{r}
# This code joins the citypop table we created with the death by city frame and then creates a new column dividing the number of deaths per city by the population (multiplying by 10,000) and then filters out any cities with populations less than a thousand, generating the 4th finding: Deaths have occurred all across L.A. County, with the biggest concentration in the small city of Commerce. Eleven have died on the small, industrial cityâ€™s streets since 2000.

death_by_city_pop <- death_by_city%>%
 inner_join(citypop)%>%
  mutate(deaths_per_capita = (city_deaths/population*10000))%>%
  filter(population > 1000)%>%
  arrange(desc(deaths_per_capita))


death_by_city_pop

```

```{r}
deaths_by_year <- streetracing%>%
  clean_names()%>%
  mutate(year = year(death_date_time))%>%
  select(year, case_num, name_first, name_last, victim_role)
 
deaths_by_year

```
```{r}

# This codeblock reverse-engineers a portion of the following finding: "The deadliest year on record was 2007, with 18 fatal crashes. After a period with relatively few recorded deaths, the count grew in recent years, with 15 fatalities in 2015, 11 in 2016 and 12 deaths in 2017, the Times analysis shows.

#This codeblock shows that "the deadliest year on record was 2007, with 18 fatal crashes" by: creating a new object called deaths_grouped and then groups the deaths_by_year table by year, and then counts the number of deaths in each year, and then arranges the total_deaths column from highest to lowest. 
deaths_grouped<- deaths_by_year%>%
  group_by(year)%>%
  summarise(total_deaths = n())%>%
  arrange(desc(total_deaths))

deaths_grouped

```
```{r}

# This codeblock reverse-engineers a portion of the following finding: "The deadliest year on record was 2007, with 18 fatal crashes. After a period with relatively few recorded deaths, the count grew in recent years, with 15 fatalities in 2015, 11 in 2016 and 12 deaths in 2017, the Times analysis shows.

#This codeblock shows that "after a period with relatively few recorded deaths, the count grew in recent years, with 15 fatalitiesin 2015, 11 in 2016 and 12 deaths in 2017," by: creating a new object called deaths_grouped_again and then grouping the deaths_by_year table by year, and then counting the number of deaths in each year, and displaying a table that shows that from 2009-2013, streetracing deaths were in the single digits until 2014, when they hit 11 and then 2015, with 15 deaths. 

deaths_grouped_again<- deaths_by_year%>%
  group_by(year)%>%
  summarise(total_deaths = n())

deaths_grouped_again
```
```{r}
deaths_by_year_expanded <- streetracing%>%
  clean_names()%>%
  mutate(year = year(death_date_time))%>%
  select(year, gender, age, case_num, name_first, name_last, victim_role)
  
deaths_by_year_expanded
```
```{r}

#this codeblock reproduces the finding that 47% of the victims were behind the wheel by grouping the victims by their role and then summarising the number of victims in each role - 85 of the 179 total victims were suspected racers (behind the wheel), which comes out to 47.4%, or 47% rounded. 

behind_wheel <- deaths_by_year_expanded%>%
  group_by(victim_role)%>%
  summarise(n())

behind_wheel
```
```{r}
male_and_young <- deaths_by_year_expanded%>%
  group_by(gender)%>%
  summarise(n())
  
male_and_young
```

```{r}
none <-streetracing%>%
  anti_join(fatalities,by = c("CaseNum"="case_number"))


none
```
